# bioscape_phydiv

This repository documents the steps to learn how to generate phylogenetic diversity measures from BioSCape eDNA data.
Data were generated by Madeline Slimp and Sean Johnson at UCSC.

At the bottom of identify_unassigned_asvs.py you need to enter the path to your asv file with the taxonomy. For the filter_fasta-by_asv_list.py, at the bottom you need to your forward and reverse fasta file paths.

# ITS2 ASV Processing Pipeline

This repository contains Python scripts designed to process and analyze ITS2 amplicon sequencing data, specifically focusing on merging forward and reverse reads, filtering ASVs, and generating a comprehensive ASV abundance table with taxonomic assignments and sequences.

## Overview of Scripts

This pipeline consists of several sequential scripts:

1.  `filter_fasta_by_asv_list.py`: Filters FASTA files based on a list of ASV IDs to remove.
2.  `combine_merged_and_unmerged_forwards.py`: Merges successfully assembled ASVs with the forward reads of unmerged pairs.
3.  `create_asv_count_table.py`: Generates a final, cleaned ASV abundance table, incorporating taxonomy and ASV sequences.

## Setup and Dependencies

These scripts are written in Python 3 and require a few external libraries. It's highly recommended to set up a dedicated Conda environment to manage these dependencies.

### 1. Create a Conda Environment

If you haven't already, create a Conda environment (e.g., `my_bio_env`) and activate it:

```bash
conda create -n my_bio_env python=3.9  # You can choose your preferred Python 3.x version
conda activate my_bio_env
2. Install Dependencies
Once your environment is activated, install the necessary libraries:

Bash

conda install biopython pandas
Usage Instructions
This section outlines the typical workflow for using these scripts. Ensure all input files are in the same directory as the scripts, or update the file paths within each script accordingly.

Assumed Input Files (from your initial bioinformatics pipeline steps):

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired_F.fasta: Original forward ASV FASTA file.

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired_R.fasta: Original reverse ASV FASTA file.

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired_F.asv: ASV counts table (often generated by DADA2 or similar tools).

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired.txt: Taxonomic assignments file for your ASVs.

Step 1: Initial Filtering of ASVs (Optional, if you have a list of ASVs to remove)
If you have a list of ASVs that you want to exclude from your forward and reverse FASTA files (e.g., unassigned ASVs from an earlier step), use this script.

Input:

unassigned_asvs_to_remove.txt (a plain text file, one ASV ID per line, e.g., from a previous filtering step)

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired_F.fasta

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired_R.fasta

Output:

filtered_ITS2_forward_asvs.fasta

filtered_ITS2_reverse_asvs.fasta

Run Command:

Bash

python filter_fasta_by_asv_list.py
(Note: You might need to adjust file paths within the if __name__ == "__main__": block of the script.)

Step 2: Merging Paired-End Reads (using BBMap's bbmerge.sh)
This step uses the bbmerge.sh tool (part of the BBMap suite) to merge your filtered forward and reverse ASV sequences. The mix=f parameter is crucial here, as it ensures out contains only successfully merged reads and outunmerged contains only unmerged pairs.

Input:

filtered_ITS2_forward_asvs.fasta (from Step 1)

filtered_ITS2_reverse_asvs.fasta (from Step 1)

Output:

merged_ITS2_asvs.fasta (successfully merged reads)

unmerged_ITS2_pairs.fasta (unmerged read pairs)

Run Command:

Bash

/path/to/bbmap/bbmerge.sh \
  in1=filtered_ITS2_forward_asvs.fasta \
  in2=filtered_ITS2_reverse_asvs.fasta \
  out=merged_ITS2_asvs.fasta \
  outunmerged=unmerged_ITS2_pairs.fasta \
  trimq=0 \
  minoverlap=10 \
  mix=f
(Note: Adjust /path/to/bbmap/bbmerge.sh to your actual BBMap installation path.)

Step 3: Combine Merged ASVs and Unmerged Forwards
This script combines the successfully merged ASVs with the forward sequences from the unmerged pairs, creating a single comprehensive FASTA file of unique ASVs.

Input:

merged_ITS2_asvs.fasta (from Step 2)

unmerged_ITS2_pairs.fasta (from Step 2)

Output:

final_combined_asvs.fasta

Run Command:

Bash

python combine_merged_and_unmerged_forwards.py
(Note: The script has predefined input/output names, ensure they match your files.)

Step 4: Create Final ASV Abundance Table with Taxonomy and Sequence
This final script takes your raw ASV counts, the taxonomic assignments, and the combined ASV FASTA file to generate a single, cleaned, tab-delimited table. This table will include ASV names, their full sequences, taxonomic paths, and read counts per sample. It also filters out any ASVs not present in your final_combined_asvs.fasta.

Input:

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired_F.asv

clve5i5mn0003l50gam95h4jx-ITS2_Plants-paired.txt

final_combined_asvs.fasta (from Step 3)

Output:

final_asv_table_with_taxonomy_and_sequence.tsv

Run Command:

Bash

python create_asv_count_table.py
(Note: The script has predefined input/output names, ensure they match your files.)

Important Notes:
File Paths: Always double-check the file paths defined within each Python script (in the if __name__ == "__main__": block) to ensure they correctly point to your input and desired output locations.

ASV Naming: The scripts assume a consistent ASV naming convention, particularly for identifying forward reads in unmerged pairs (e.g., containing _F_ in their ID) and for matching ASVs between different files.

Conda Environment: Always activate your my_bio_env environment before running any of the Python scripts (conda activate my_bio_env).
